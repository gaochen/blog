---
title: 你不知道的javascript--作用域
date: 2016-04-19 14:39:20
tags:
---

### 作用域：是一套设计良好的规则，用来存储变量，并且之后可以方便地找到这些变量。

引擎：从头到尾负责整个JavaScript 程序的编译及执行过程。

编译器：负责语法分析及代码生成等。

作用域：负责收集并维护由所有声明的标识符(变量)组成的一系列查询，并实施一套非常严格的规则，确定当前执行的代码对这些标识符的访问权限。

``` JavaScript
//或者调整参数
var a = 2;  //这段代码是如何执行的
```
<!--more-->

简单来说：变量的赋值操作会执行两个动作，首先编译器会在当前作用域中声明一个变量（如果之前没有声明过），然后在运行时引擎会在作用域中查找该变量，如果能够找到就会对它赋值。

在这个例子中，引擎会为变量a 进行LHS 查询。另外一个查找的类型叫作RHS。

LHS：找到变量的容器本身，从而可以对其赋值。

``` JavaScript
var a = 2;  //这里对a的引用则是LHS引用，因为不关心a的值，只是想要为=2这个赋值操作找到一个目标
```

RHS：与简单地查找某个变量的值，不进行赋值。

``` JavaScript
console.log(a);   //  对a的引用是一个RHS引用，因为这里a并没有赋予任何值，只是找到获取到a的值，
                  //  传递给console.log(...)
```

例子：
``` JavaScript
function foo(a) {
    var b = a;
    return a + b;
}

var c = foo(2);

LHS：3处，c=...; a=2(隐式变量分配); b=... ;
RHS：4处，foo(2...; =a; a...; b...;
```

异常情况：

非严格模式下，当变量还没有声明（在任何作用域中都无法找到该变量），这两种查询的行为是不一样的。

如果是RHS查询，引擎就会抛出ReferenceError异常。

如果是LHS查询，全局作用域中就会隐式的创建一个具有该名称的变量，并将其返还给引擎，前提是程序运行在非“严格模式”下。

如果RHS查询到了变量，但是对这个变量的值进行了不合理的操作，那么引擎会抛出另外一种类型的异常，叫作TypeError。

ReferenceError同作用域判别失败相关，而TypeError则代表作用域判别成功了，但是对结果的操作是非法或不合理的。



